<!DOCTYPE html>
<html>

<head>
    <title>Machine</title>
    <style>
        body{
            background-color: rgb(223, 255, 255);
        }
        tbody {
            text-align: center;
        }
        #index_list tr{
            background-color: rgb(182, 221, 221);
        }
    </style>
</head>

<body>
    <center>
        <table width="95%">
            <tbody>
                <tr>
                    <td height="20">
                        <font color="black">
                            Machine
                        </font>
                    </td>
                </tr>
            </tbody>
        </table>
        <table width="95%">
            <tbody>
                <tr>
                    <td>
                        <center>
                            <table id="machine_list" border="1" width="95%">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>PCB ID</th>
                                    <th>Function</th>
                                </tr>
                            </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </center>
                    </td>
                </tr>
            </tbody>
        </table>
<button onclick="genMachine()">New Machine</button>
<p style="color:red;"></p>
    </center>

    <script>
        function getMachine() {
            let http = new XMLHttpRequest();
            let url = "/api/machine/list";
            http.withCredentials = true;
            http.onreadystatechange = function () {
                if (http.readyState == XMLHttpRequest.DONE) {
                    let resp = JSON.parse(http.responseText);
                    if (http.status == 200) {
                        let table = document.getElementById("machine_list");
                        if(resp.data[0].id){
                            resp.data.forEach(function(item){
                                let row = table.insertRow(-1);

                                row.insertCell(0).innerText = item.id;
                                row.insertCell(1).innerText = item.pcbId;
                                row.insertCell(2).innerHTML = '<button onclick="deleteMachine('+item.id+')">Delete</button>';
                            })
                        }
                    } else {
                        alert(resp.data.message);
                    }

                }
            }
            http.open("GET", url);
            http.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            http.send();
        }

        function genMachine(){
            let http = new XMLHttpRequest();
            let url = "/api/machine/generate";
            http.withCredentials = true;
            http.onreadystatechange = function () {
                if (http.readyState == XMLHttpRequest.DONE) {
                    let resp = JSON.parse(http.responseText);
                    if (http.status == 200) {
                        alert("OK");
                        let table = document.getElementById("machine_list");
                        table.innerHTML = "";
                        location.reload();
                    } else {
                        alert(resp.data.message);
                    }

                }
            }
            http.open("POST", url);
            http.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            http.send();
        }

        function deleteMachine(id){
            let http = new XMLHttpRequest();
            let url = "/api/machine/delete";
            http.withCredentials = true;
            http.onreadystatechange = function () {
                if (http.readyState == XMLHttpRequest.DONE) {
                    let resp = JSON.parse(http.responseText);
                    if (http.status == 200) {
                        alert("OK");
                        location.reload();
                    } else {
                        alert(resp.data.message);
                    }

                }
            }
            http.open("POST", url);
            http.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            http.send(JSON.stringify({"machineId":id}));
            console.log(this.parentElement.nodeName);
        }




        window.onload = function(){
            getMachine();
        }
    </script>
</body>

</html>